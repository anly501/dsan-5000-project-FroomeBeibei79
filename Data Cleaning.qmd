---
title: "Data Cleaning Code"
format: html
---


This is code section


# Record Data

## Gender

Below is the progress to clean the gender dataset
```{r, echo = TRUE, message = FALSE}
library(readxl)
library(tidyverse)
gender <- read_excel("data/dl220.xls")
gender <- gender[-(1:2),]
colnames(gender) <- gender[1,]
gender <- gender[-1,]
gender <- gender[1:(nrow(gender) -4),]
colnames(gender)[1] <- "Year"
gender <- gender[-1,]
colnames1 <- paste0(colnames(gender), unlist(gender[1,]))
colnames(gender) <- colnames1
gender <- gender[-1,]

names <- which(duplicated(colnames(gender)))
for (col_index in names){
  colnames(gender)[col_index] <- paste0(colnames(gender)[col_index], "_", col_index)
}

```



# Text Data

First I use NewsAPI to get text data from NewsAPI on different key words in terms of driver behavior analysis

The key words I used are: driving behavior, distracted driving, driver risk assessment, driver profilling
```{python, echo= TRUE, message=FALSE, results = "hide"}
import requests
import json
import re
import os
import pandas as pd
from sklearn.feature_extraction.text import CountVectorizer

baseURL = "https://newsapi.org/v2/everything?"
total_requests=1
verbose=True

API_KEY='2133663c4ec54af8a9839f0c500203de'
TOPIC1 = 'driver profiling'

URLpost1 = {'apiKey': API_KEY,
            'q': '+'+TOPIC1,
            'sortBy': 'relevancy',
            'totalRequests': 1}

print(baseURL)

response1 = requests.get(baseURL, URLpost1) 

response1 = response1.json() 

print(json.dumps(response1, indent=2))

from datetime import datetime
timestamp = datetime.now().strftime("%Y-%m-%d-H%H-M%M-S%S")

output_file_path = os.path.join("data", f'{timestamp}-topic1-newapi-raw-data-driver-profilling.json')

with open(output_file_path, 'w') as outfile:
    json.dump(response1, outfile, indent=4)
```